# ZRDDS Python 双向聊天示例

这是一个基于ZRDDS Python绑定的双向聊天示例，实现了类似您提供的C++版本的功能。

## 功能特性

- ✅ **双向通信**: 每个进程既能发送消息，也能接收消息
- ✅ **长消息支持**: 支持最长512字符的消息
- ✅ **自动换行**: 长消息会自动换行显示，保持界面整洁
- ✅ **时间戳**: 每条消息都带有发送时间
- ✅ **用户区分**: 清楚区分自己发送的消息和对方发送的消息
- ✅ **优雅退出**: 输入'exit'或Ctrl+C可以优雅退出

## 使用方法

### 1. 启动第一个聊天窗口

```bash
python chat_example.py
```

输入你的名字，例如：`Alice`

### 2. 启动第二个聊天窗口

在另一个终端窗口中运行：

```bash
python chat_example.py
```

输入另一个名字，例如：`Bob`

### 3. 开始聊天

现在两个窗口可以互相发送消息了！

## 示例对话

**Alice的窗口:**
```
=== ZRDDS Python 双向聊天示例 ===
基于ShapeType数据类型的聊天系统
支持长消息自动换行显示
==================================================
请输入你的名字: Alice

[系统] 聊天系统初始化成功，域ID: 80

[系统] 欢迎 Alice！
[系统] 输入消息开始聊天，输入 'exit' 退出
[系统] 支持长消息，会自动换行显示
--------------------------------------------------
[Alice] 请输入消息: 你好Bob！
[14:30:15][你] 你好Bob！
[14:30:20][对方 Bob] 你好Alice！很高兴见到你
[Alice] 请输入消息: 这是一条很长的消息，用来测试自动换行功能。
       这条消息应该会自动换行显示，让界面保持整洁。
[14:30:25][你] 这是一条很长的消息，用来测试自动换行功能。
       这条消息应该会自动换行显示，让界面保持整洁。
[14:30:30][对方 Bob] 看到了！换行功能工作得很好
[Alice] 请输入消息: exit
[系统] 聊天系统已关闭
```

**Bob的窗口:**
```
=== ZRDDS Python 双向聊天示例 ===
基于ShapeType数据类型的聊天系统
支持长消息自动换行显示
==================================================
请输入你的名字: Bob

[系统] 聊天系统初始化成功，域ID: 80

[系统] 欢迎 Bob！
[系统] 输入消息开始聊天，输入 'exit' 退出
[系统] 支持长消息，会自动换行显示
--------------------------------------------------
[14:30:15][对方 Alice] 你好Bob！
[Bob] 请输入消息: 你好Alice！很高兴见到你
[14:30:20][你] 你好Alice！很高兴见到你
[14:30:25][对方 Alice] 这是一条很长的消息，用来测试自动换行功能。
       这条消息应该会自动换行显示，让界面保持整洁。
[Bob] 请输入消息: 看到了！换行功能工作得很好
[14:30:30][你] 看到了！换行功能工作得很好
[Bob] 请输入消息: exit
[系统] 聊天系统已关闭
```

## 技术实现

### 数据格式

使用ShapeType数据类型，消息格式为：`用户名:消息内容`

- `data.x`: 固定为0
- `data.y`: 固定为0  
- `data.z`: 存储格式化的消息字符串

### 核心组件

1. **ChatListener**: 继承自`DataReaderListener`，处理接收到的消息
2. **ChatApp**: 主应用类，管理DDS组件的生命周期
3. **自动换行**: 使用`textwrap.wrap()`实现长消息的自动换行

### DDS组件

- **DomainParticipant**: 域参与者，域ID为80
- **Topic**: 主题名称为"CHAT_TOPIC"
- **Publisher/DataWriter**: 用于发送消息
- **Subscriber/DataReader**: 用于接收消息
- **Listener**: 异步处理接收到的消息

## 注意事项

1. **域ID**: 两个聊天实例必须使用相同的域ID（80）
2. **主题名称**: 使用相同的主题名称"CHAT_TOPIC"
3. **数据类型**: 必须使用相同的ShapeType数据类型
4. **网络**: 确保两个进程能够通过网络通信（如果在不同机器上）

## 故障排除

### 常见问题

1. **无法接收消息**
   - 检查域ID是否一致
   - 检查主题名称是否一致
   - 检查网络连接

2. **发送失败**
   - 检查DDS组件初始化是否成功
   - 查看错误日志

3. **监听器不工作**
   - 确保使用了正确的trampoline类
   - 检查监听器注册是否正确

### 调试模式

可以在代码中添加更多调试信息：

```python
# 在initialize方法中添加
print(f"[调试] 域ID: {self.domain_id}")
print(f"[调试] 主题名称: {self.topic_name}")
print(f"[调试] 类型名称: {type_support.get_type_name()}")
```

## 扩展功能

可以考虑添加的功能：

1. **消息历史**: 保存聊天记录
2. **文件传输**: 支持发送文件
3. **群聊**: 支持多个用户同时聊天
4. **加密**: 消息加密传输
5. **GUI界面**: 图形用户界面

## 依赖

- Python 3.6+
- ZRDDS Python绑定模块
- 标准库：sys, time, threading, textwrap, datetime
