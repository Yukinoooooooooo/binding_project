# DDS 性能测试工具 (分离版)

专门为两设备测试设计的DDS性能测试工具，包含独立的发送端和接收端程序。

## 文件说明

- `perf_sender.py` - 发送端程序
- `perf_receiver.py` - 接收端程序  
- `run_perf_test.bat` - 启动脚本
- `README_perf_separate.md` - 使用说明

## 使用方法

### 方法1: 使用批处理脚本
双击 `run_perf_test.bat` 文件，选择运行模式：
- 选择1：只运行发送端
- 选择2：只运行接收端
- 选择3：同时运行两个程序

### 方法2: 直接运行Python脚本

#### 发送端
```bash
python perf_sender.py
```

#### 接收端
```bash
python perf_receiver.py
```

## 测试流程

### 1. 两设备测试流程

**设备A (发送端)**:
1. 运行 `perf_sender.py`
2. 输入参数：
   - DDS域ID: 80 (默认)
   - 主题名称: PERF_TEST (默认)
   - 发送消息数量: 1000
   - 发送间隔: 0.01秒

**设备B (接收端)**:
1. 运行 `perf_receiver.py`
2. 输入参数：
   - DDS域ID: 80 (必须与发送端相同)
   - 主题名称: PERF_TEST (必须与发送端相同)
   - 期望接收消息数量: 1000
   - 接收超时时间: 60秒

### 2. 单设备测试流程

1. 先运行接收端：`python perf_receiver.py`
2. 再运行发送端：`python perf_sender.py`
3. 观察两个程序的输出

## 性能指标

### 发送端指标
- **发送时长**: 实际发送所有消息的时间
- **发送频率**: 每秒发送的消息数量
- **平均间隔**: 每条消息的平均发送间隔

### 接收端指标
- **丢包率**: 丢失消息的百分比
- **吞吐量**: 每秒接收的消息数量
- **延迟统计**: 平均、最小、最大、中位数、P95、P99延迟

## 测试结果示例

### 发送端输出
```
==================================================
📊 发送端统计
==================================================
发送时长: 10.25 秒
发送消息: 1000 条
发送频率: 97.56 消息/秒
平均间隔: 10.25 ms/条
==================================================
```

### 接收端输出
```
==================================================
📊 接收端统计
==================================================
接收时长: 10.30 秒
期望接收: 1000 条
实际接收: 998 条
丢失消息: 2 条
丢包率: 0.20%
吞吐量: 96.89 消息/秒

延迟统计 (毫秒):
  平均延迟: 2.45 ms
  最小延迟: 1.23 ms
  最大延迟: 8.76 ms
  中位延迟: 2.12 ms
  P95延迟:  4.56 ms
  P99延迟:  6.78 ms
==================================================
```

## 推荐测试参数

### 小规模测试
- 消息数量: 100-500条
- 发送间隔: 0.01秒 (10ms)
- 超时时间: 30秒

### 中等规模测试
- 消息数量: 1000-2000条
- 发送间隔: 0.01秒 (10ms)
- 超时时间: 60秒

### 大规模测试
- 消息数量: 5000-10000条
- 发送间隔: 0.01秒 (10ms)
- 超时时间: 120秒

### 高频率测试
- 消息数量: 1000条
- 发送间隔: 0.001秒 (1ms)
- 超时时间: 30秒

## 注意事项

1. **网络配置**: 确保两台设备在同一网络，能够相互通信
2. **参数一致**: 发送端和接收端必须使用相同的域ID和主题名称
3. **时序控制**: 建议先启动接收端，再启动发送端
4. **超时设置**: 接收超时时间应该大于发送时间
5. **防火墙**: 检查防火墙设置，确保DDS通信端口开放

## 故障排除

### 常见问题

1. **接收端收不到消息**
   - 检查域ID和主题名称是否一致
   - 确认网络连接正常
   - 检查防火墙设置

2. **丢包率过高**
   - 降低发送频率
   - 检查网络稳定性
   - 增加接收超时时间

3. **延迟过高**
   - 检查网络延迟
   - 降低系统负载
   - 检查DDS配置

### 调试技巧

1. **查看DDS日志**: 检查DDS发现和连接状态
2. **网络测试**: 使用ping测试网络连通性
3. **逐步测试**: 先用小数量消息测试，再增加规模
4. **监控资源**: 观察CPU和内存使用情况

## 扩展功能

可以根据需要扩展以下功能：
- 自定义消息大小
- 多主题并发测试
- QoS配置测试
- 网络故障模拟
- 实时性能监控
- 测试结果导出
